# Tencent EdgeOne Cache Manager - 功能说明

## 📖 目录
- [功能概览](#功能概览)
- [配置指南](#配置指南)
- [测试连接](#测试连接)
- [缓存清理策略](#缓存清理策略)
- [UI特性](#ui特性)
- [常见问题](#常见问题)

---

## 功能概览

### 核心功能
1. **自动缓存清理** - 文章发布/更新时自动触发
2. **手动缓存清理** - 支持单篇和全站清理
3. **连接测试** - 验证 API 配置是否正确
4. **可视化管理** - 现代化的管理界面

### 插件状态
插件会实时显示当前的配置状态：
- 🟢 **已配置** - SDK 已安装且 API 配置完整
- 🟡 **待配置** - SDK 已安装但缺少必要配置
- 🔴 **SDK 未安装** - 需要安装腾讯云 SDK

---

## 配置指南

### 步骤 1: 安装 SDK
在插件目录执行：
```bash
cd wp-content/plugins/teo-cache-purge
composer require tencentcloud/teo
```

### 步骤 2: 获取 API 凭证

#### 2.1 获取 SecretId 和 SecretKey
1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/cam/capi)
2. 进入 "访问管理 > 访问密钥 > API密钥管理"
3. 创建密钥或查看现有密钥
4. 复制 `SecretId` 和 `SecretKey`

#### 2.2 获取 Zone ID
1. 登录 [EdgeOne 控制台](https://console.cloud.tencent.com/edgeone)
2. 选择您的站点
3. 在站点概览页面找到 `Zone ID`
4. 格式通常为 `zone-xxxxxxxx`

### 步骤 3: 填写配置
1. 进入 WordPress 后台
2. 导航至 "设置 > EdgeOne 缓存"
3. 填写以下信息：
   - **SecretId*** (必填)
   - **SecretKey*** (必填，支持显示/隐藏)
   - **Zone ID*** (必填)
   - **默认主机名** (可选，留空则使用站点域名)
4. 点击 "保存设置"

### 步骤 4: 测试连接
1. 保存配置后，点击 "测试连接" 按钮
2. 系统会：
   - 验证 SDK 是否正确安装
   - 检查配置是否完整
   - 调用腾讯云 API 获取站点信息
3. 成功示例：
   ```
   ✅ 连接成功！站点信息：example.com (状态: active)
   ```
4. 失败示例：
   ```
   ❌ 连接失败：SecretId 或 SecretKey 不正确
   ```

---

## 测试连接

### 功能说明
测试连接功能会调用腾讯云 `DescribeZones` API 来验证：
- API 凭证是否有效
- Zone ID 是否存在
- 是否有权限访问该站点

### 测试流程
```
[用户点击测试] 
    ↓
[检查 SDK] → 未安装则提示
    ↓
[检查配置] → 缺失则提示
    ↓
[调用 API] → 获取站点信息
    ↓
[显示结果] → 成功/失败消息
```

### 返回信息
成功时返回：
- 站点名称 (ZoneName)
- 站点状态 (Status)
  - `active` - 激活中
  - `pending` - 待激活
  - `paused` - 已暂停

---

## 缓存清理策略

### 1. 文章更新 (purge_url)
**触发时机**: 已发布文章更新时
**清理范围**: 仅清理该文章的 URL 缓存
**API 方法**: `purge_url`
**适用场景**:
- 修改文章内容
- 更新文章标题
- 调整文章分类/标签

### 2. 首次发布 (purge_host + invalidate)
**触发时机**: 新文章首次发布时
**清理范围**: 清理整个域名的缓存
**API 方法**: `purge_host` + `Method: invalidate`
**适用场景**:
- 新文章发布（首页、归档页等都会显示）
- 需要更新列表页缓存

### 3. 文章列表手动清理 (purge_url)
**触发时机**: 在文章列表点击"清理缓存"
**清理范围**: 仅清理该文章的 URL 缓存
**API 方法**: `purge_url`
**适用场景**:
- 手动强制刷新特定文章
- 验证缓存是否生效

### 4. 全站清理 (purge_all + invalidate)
**触发时机**: 手动点击"一键清理全站缓存"
**清理范围**: 清理站点所有缓存
**API 方法**: `purge_all` + `Method: invalidate`
**适用场景**:
- 网站主题更换
- 重大功能更新
- 全局样式修改
- 紧急问题修复

⚠️ **注意**: 全站清理会导致短时间内源站压力增大，请谨慎使用！

---

## UI特性

### 卡片式布局
- **API 配置卡片** - 凸显配置区域
- **策略说明卡片** - 网格展示四种策略
- **危险操作卡片** - 红色警告样式

### 状态指示
- **配置状态徽章** - 标题旁显示当前状态
- **字段验证图标** - 已填字段显示绿色✓
- **SDK 安装提示** - 未安装时显示安装命令

### 响应式设计
- **桌面端** (>782px)
  - 按钮横向排列
  - 策略说明多列显示
- **移动端** (≤782px)
  - 按钮垂直排列
  - 策略说明单列显示
  - 按钮自动100%宽度

### 交互优化
- **密码显示/隐藏** - SecretKey 可切换显示
- **二次确认** - 全站清理有详细警告
- **禁用状态** - 配置不完整时自动禁用操作按钮
- **悬停效果** - 按钮和链接有视觉反馈

### 配色方案
```css
主色调: #2271b1 (WordPress Blue)
成功色: #00a32a (绿色)
警告色: #856404 (黄色)
危险色: #d63638 (红色)
边框色: #c3c4c7 (浅灰)
背景色: #f6f7f7 (极浅灰)
```

---

## 常见问题

### Q1: 提示"SDK 未安装"怎么办？
**A**: 在插件目录执行:
```bash
cd wp-content/plugins/teo-cache-purge
composer require tencentcloud/teo
```

### Q2: 测试连接失败，提示"SecretId 或 SecretKey 不正确"
**A**: 
1. 检查是否复制完整（注意空格）
2. 确认密钥状态为"启用"
3. 验证账号是否有 EdgeOne 权限

### Q3: 测试连接失败，提示"未找到对应的 Zone ID"
**A**:
1. 确认 Zone ID 格式正确 (zone-xxxxxxxx)
2. 检查该站点是否存在
3. 确认 API 密钥有访问该站点的权限

### Q4: 全站清理按钮是灰色的，无法点击
**A**: 检查以下条件：
- SDK 是否已安装
- SecretId、SecretKey、Zone ID 是否都已填写

### Q5: 文章更新后缓存没有清理？
**A**:
1. 查看 WordPress 错误日志
2. 手动点击"测试连接"验证配置
3. 检查文章是否为"已发布"状态

### Q6: 如何查看缓存清理是否成功？
**A**:
1. 操作后会显示成功/失败提示
2. 可以在浏览器中清除缓存后重新访问
3. 检查响应头中的缓存状态

### Q7: 移动端界面显示异常
**A**: 
确保 WordPress 后台主题支持响应式设计，本插件已适配所有主流屏幕尺寸。

### Q8: 密码输入框看不到输入的内容
**A**:
这是安全特性。点击旁边的 👁️ 按钮可以显示/隐藏密码。

---

## 技术支持

- **问题反馈**: [GitHub Issues](https://github.com/Iconkop/wp_expand/issues)
- **EdgeOne 文档**: https://cloud.tencent.com/document/product/1552
- **API 参考**: https://cloud.tencent.com/document/api/1552/70789

---

**版本**: 1.0.3  
**更新日期**: 2025-10-31  
**作者**: RV
